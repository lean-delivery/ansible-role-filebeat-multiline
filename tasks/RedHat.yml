---
# - name: Setting InitD init system variables.
#   set_fact:
#     filebeat: "{{ filebeat | combine(initd) }}"
#   when: ansible_service_mgr != 'systemd'

- name: Set Filebeat version if defined
  set_fact:
    fb_package_name: '{{ fb_package_name }}-{{ filebeat_version }}'
  when: filebeat_version.find('.x') == -1

- name: Redhat - Importing latest logstash GPG Key
  become: True
  rpm_key:
    key: '{{ elastic_gpg_key }}'
    state: present
  register: installed_key
  until: installed_key is succeeded

- name: Redhat - Install elasticsearch repository
  become: True
  yum_repository:
    name: elasticsearch
    description: Elasticsearch repository
    file: '{{ es_repo_file }}'
    baseurl: '{{ es_yum_url }}'
    gpgcheck: True
    gpgkey: '{{ elastic_gpg_key }}'
    enabled: True
    state: present

- name: Redhat - Installing Filebeat package
  become: True
  yum:
    name: '{{ fb_package_name }}'
    state: present
    update_cache: True
  register: installed_package
  until: installed_package is succeeded
